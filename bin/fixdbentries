#!/bin/bash
# Script to adjust the contents of the DB entries after a package move.
# Fairly straight forward... ./movedbentry 'from/here' 'to/here' /over/here
# $Header: /local/data/ulm/cvs/history/var/cvsroot/gentoo-src/portage/bin/fixdbentries,v 1.1 2003/03/22 14:24:38 carpaski Exp $

VAR=$1
NEW=$2
SPATH=$3

grep -FrZl "${VAR}" "${SPATH}" |
sed "s#${SPATH}[^\d000]\+/CONTENTS\d000##g" |
xargs -0r sed -i -e "
s#${VAR}\$#${NEW}#g; 
s#${VAR}\([[:space:]]\)#${NEW}\1#g; 
s#${VAR}\(-[^a-zA-Z]\)#${NEW}\1#g; 
s#${VAR}\([^a-zA-Z0-9-]\)#${NEW}\1#g
"
