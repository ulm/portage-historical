#!/bin/bash
# Copyright 1999-2002 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License v2
# $Header: /local/data/ulm/cvs/history/var/cvsroot/gentoo-src/portage/bin/prepman,v 1.3 2002/11/23 19:21:59 vapier Exp $

if [ -z "$1" ] ; then
	z="${D}usr/man"
else
	z="${D}$1/man"
fi

for x in ${z}/* ; do
	for y in ${x}/* ; do
		if [ -h "${y}" ] ; then
			#symlink
			linkto=`ls -l ${y} | sed -e "s:${D}::" | awk '{ printf ("%s.gz",$11) } '`
	        	echo "$linkto $y.gz"
			ln -sf "${linkto}" "${y}.gz"
			rm "${y}"
		else
			gzip -f -9 "${y}"
		fi	
	done
done
